<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kzl - Ar Condicionado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            margin: 100px auto;
        }

        .login-box h2 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-box h3 {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .dashboard {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid white;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            padding: 0 30px;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-small {
            padding: 5px 12px;
            font-size: 12px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pendente { background: #fff3cd; color: #856404; }
        .status-agendado { background: #d1ecf1; color: #0c5460; }
        .status-conclu√≠do { background: #d4edda; color: #155724; }
        .status-cancelado { background: #f8d7da; color: #721c24; }
        .status-aprovado { background: #d4edda; color: #155724; }
        .status-recusado { background: #f8d7da; color: #721c24; }
        .status-em-andamento { background: #d1ecf1; color: #0c5460; }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
        }

        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login -->
        <div class="login-box" id="loginBox">
            <h2>üõ†Ô∏è Kzl </h2>
            <h3>Ar Condicionado</h3>
            
            <div class="form-group">
                <label>Usu√°rio</label>
                <input type="text" id="loginUsername" placeholder="Digite seu usu√°rio">
            </div>
            
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="loginPassword" placeholder="Digite sua senha">
            </div>
            
            <button class="btn" style="width: 100%; margin-top: 20px;" onclick="app.login()">Entrar</button
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <div class="header">
                <h1>Kzl - Ar Condicionado</h1>
                <div>
                    <span id="userDisplay"></span>
                    <button class="logout-btn" onclick="app.logout()">Sair</button>
                </div>
            </div>

            <div class="tabs" id="tabsContainer"></div>

            <div class="content">
                <div id="alertContainer"></div>
                
                <!-- Dashboard -->
                <div class="tab-content" id="tab-dashboard">
                    <h2 style="margin-bottom: 20px;">Dashboard</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="statClientes">0</h3>
                            <p>Clientes Cadastrados</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="statOrcamentos">0</h3>
                            <p>Or√ßamentos Ativos</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="statServicos">0</h3>
                            <p>Servi√ßos Agendados</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="statManutencoes">0</h3>
                            <p>Manuten√ß√µes Pendentes</p>
                        </div>
                    </div>
                </div>

                <!-- Clientes -->
                <div class="tab-content" id="tab-clientes">
                    <h2>Cadastro de Clientes</h2>
                    
                    <div class="import-export-section">
                        <div class="file-input-wrapper">
                            <input type="file" id="importExcel" accept=".xlsx,.xls" onchange="app.importarExcel(event)">
                            <label for="importExcel" class="file-input-label">üì• Importar do Excel</label>
                        </div>
                        <button class="btn btn-info" onclick="app.exportarExcel()">üì§ Exportar para Excel</button>
                        <button class="btn btn-success" onclick="app.baixarModeloExcel()">üìã Baixar Modelo</button>
                    </div>

                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="card">
                            <h3>Novo Cliente</h3>
                            <div class="form-group">
                                <label>Nome/Empresa</label>
                                <input type="text" id="clienteNome">
                            </div>
                            <div class="form-group">
                                <label>Telefone</label>
                                <input type="text" id="clienteTelefone">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="clienteEmail">
                            </div>
                            <div class="form-group">
                                <label>Endere√ßo</label>
                                <textarea id="clienteEndereco"></textarea>
                            </div>
                            <button class="btn" onclick="app.salvarCliente()">Salvar Cliente</button>
                        </div>
                        
                        <div class="card">
                            <h3>Clientes Cadastrados</h3>
                            <div class="form-group">
                                <input type="text" id="searchCliente" placeholder="Buscar cliente..." onkeyup="app.filtrarClientes()">
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Telefone</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clientesTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Or√ßamentos -->
                <div class="tab-content" id="tab-orcamentos">
                    <h2>Or√ßamentos</h2>
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="card">
                            <h3>Novo Or√ßamento</h3>
                            <div class="form-group">
                                <label>Cliente</label>
                                <select id="orcamentoCliente"></select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Servi√ßo</label>
                                <select id="orcamentoTipo">
                                    <option value="Instala√ß√£o">Instala√ß√£o</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Reparo">Reparo</option>
                                    <option value="Limpeza">Limpeza</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <textarea id="orcamentoDescricao"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Valor (R$)</label>
                                <input type="number" id="orcamentoValor" step="0.01">
                            </div>
                            <button class="btn" onclick="app.salvarOrcamento()">Salvar Or√ßamento</button>
                        </div>
                        
                        <div class="card">
                            <h3>Or√ßamentos Cadastrados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Tipo</th>
                                            <th>Valor</th>
                                            <th>Status</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orcamentosTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agendamentos -->
                <div class="tab-content" id="tab-agendamentos">
                    <h2>Agendamentos de Servi√ßo</h2>
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="card">
                            <h3>Novo Agendamento</h3>
                            <div class="form-group">
                                <label>Cliente</label>
                                <select id="agendamentoCliente"></select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Servi√ßo</label>
                                <select id="agendamentoTipo">
                                    <option value="Instala√ß√£o">Instala√ß√£o</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Reparo">Reparo</option>
                                    <option value="Limpeza">Limpeza</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Data e Hora</label>
                                <input type="datetime-local" id="agendamentoData">
                            </div>
                            <div class="form-group">
                                <label>T√©cnico Respons√°vel</label>
                                <input type="text" id="agendamentoTecnico">
                            </div>
                            <div class="form-group">
                                <label>Observa√ß√µes</label>
                                <textarea id="agendamentoObs"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="agendamentoStatus">
                                    <option value="Agendado">Agendado</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Conclu√≠do">Conclu√≠do</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            <button class="btn" onclick="app.salvarAgendamento()">Salvar Agendamento</button>
                            <button class="btn" onclick="app.salvarAgendamento()">Salvar Agendamento</button>
                        </div>
                        
                        <div class="card">
                            <h3>Agendamentos</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Data/Hora</th>
                                            <th>Tipo</th>
                                            <th>Status</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="agendamentosTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manuten√ß√µes -->
                <div class="tab-content" id="tab-manutencoes">
                    <h2>Hist√≥rico de Manuten√ß√µes</h2>
                    <div class="card" style="margin-top: 20px;">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Servi√ßo Realizado</th>
                                        <th>T√©cnico</th>
                                    </tr>
                                </thead>
                                <tbody id="manutencoesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Usu√°rios -->
                <div class="tab-content" id="tab-usuarios">
                    <h2>Gerenciar Usu√°rios</h2>
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="card">
                            <h3>Novo Usu√°rio</h3>
                            <div class="form-group">
                                <label>Nome</label>
                                <input type="text" id="usuarioNome">
                            </div>
                            <div class="form-group">
                                <label>Usu√°rio (login)</label>
                                <input type="text" id="usuarioLogin">
                            </div>
                            <div class="form-group">
                                <label>Senha</label>
                                <input type="password" id="usuarioSenha">
                            </div>
                            <div class="form-group">
                                <label>Tipo de Usu√°rio</label>
                                <select id="usuarioTipo">
                                    <option value="admin">Administrador</option>
                                    <option value="tecnico">T√©cnico</option>
                                    <option value="vendedor">Vendedor</option>
                                </select>
                            </div>
                            <button class="btn" onclick="app.salvarUsuario()">Salvar Usu√°rio</button>
                        </div>
                        
                        <div class="card">
                            <h3>Usu√°rios Cadastrados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Login</th>
                                            <th>Tipo</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usuariosTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        const app = {
            KEY: 'sistemaAC_2024',
            dados: {
                clientes: [],
                orcamentos: [],
                agendamentos: [],
                usuarios: []
            },
            usuarioPadrao: { nome: 'Administrador', login: 'admin', senha: btoa('admin123'), tipo: 'admin' },
            usuarioLogado: null,

            init() {
                this.carregarDados();
                this.verificarSessao();
            },

            carregarDados() {
                const dados = localStorage.getItem(this.KEY);
                if (dados) {
                    try {
                        this.dados = JSON.parse(dados);
                    } catch (e) {
                        console.error('Erro ao carregar dados');
                    }
                }
                
                // Garante que sempre exista o usu√°rio admin padr√£o
                if (this.dados.usuarios.length === 0) {
                    this.dados.usuarios.push(this.usuarioPadrao);
                    this.salvarDados();
                }
            },

            salvarDados() {
                localStorage.setItem(this.KEY, JSON.stringify(this.dados));
            },

            verificarSessao() {
                const usuarioSalvo = sessionStorage.getItem('usuarioLogado');
                if (usuarioSalvo) {
                    try {
                        this.usuarioLogado = JSON.parse(usuarioSalvo);
                        document.getElementById('loginBox').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                        document.getElementById('userDisplay').textContent = `${this.usuarioLogado.nome} (${this.usuarioLogado.tipo})`;
                        this.configurarAbas();
                        this.atualizarDashboard();
                        this.mostrarAba('dashboard');
                    } catch (e) {
                        sessionStorage.removeItem('usuarioLogado');
                    }
                }
            },

            login() {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                
                const usuario = this.dados.usuarios.find(u => 
                    u.login === username && atob(u.senha) === password
                );
                
                if (usuario) {
                    this.usuarioLogado = usuario;
                    sessionStorage.setItem('usuarioLogado', JSON.stringify(usuario));
                    document.getElementById('loginBox').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    document.getElementById('userDisplay').textContent = `${usuario.nome} (${usuario.tipo})`;
                    this.configurarAbas();
                    this.atualizarDashboard();
                    this.mostrarAba('dashboard');
                } else {
                    this.mostrarAlerta('Usu√°rio ou senha incorretos!', 'error');
                }
            },

            logout() {
                this.usuarioLogado = null;
                sessionStorage.removeItem('usuarioLogado');
                document.getElementById('loginBox').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            },

            configurarAbas() {
                const abas = [
                    { id: 'dashboard', nome: 'Dashboard', permissoes: ['admin', 'tecnico', 'vendedor'] },
                    { id: 'clientes', nome: 'Clientes', permissoes: ['admin', 'vendedor'] },
                    { id: 'orcamentos', nome: 'Or√ßamentos', permissoes: ['admin', 'vendedor'] },
                    { id: 'agendamentos', nome: 'Agendamentos', permissoes: ['admin', 'tecnico', 'vendedor'] },
                    { id: 'manutencoes', nome: 'Manuten√ß√µes', permissoes: ['admin', 'tecnico'] },
                    { id: 'usuarios', nome: 'Usu√°rios', permissoes: ['admin'] }
                ];
                
                const container = document.getElementById('tabsContainer');
                container.innerHTML = '';
                
                abas.forEach(aba => {
                    if (aba.permissoes.includes(this.usuarioLogado.tipo)) {
                        const btn = document.createElement('button');
                        btn.className = 'tab';
                        btn.textContent = aba.nome;
                        btn.onclick = () => this.mostrarAba(aba.id);
                        container.appendChild(btn);
                    }
                });
            },

            mostrarAba(abaId) {
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                
                const tabContent = document.getElementById(`tab-${abaId}`);
                if (tabContent) {
                    tabContent.classList.add('active');
                    event?.target?.classList?.add('active');
                }
                
                const atualizadores = {
                    'clientes': () => this.atualizarTabelaClientes(),
                    'orcamentos': () => this.atualizarTabelaOrcamentos(),
                    'agendamentos': () => this.atualizarTabelaAgendamentos(),
                    'manutencoes': () => this.atualizarTabelaManutencoes(),
                    'usuarios': () => this.atualizarTabelaUsuarios()
                };
                
                if (atualizadores[abaId]) atualizadores[abaId]();
            },

            mostrarAlerta(mensagem, tipo) {
                const container = document.getElementById('alertContainer');
                container.innerHTML = `<div class="alert alert-${tipo}">${mensagem}</div>`;
                setTimeout(() => container.innerHTML = '', 3000);
            },
            <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>


            atualizarDashboard() {
                // Total de clientes
                document.getElementById('statClientes').textContent = this.dados.clientes.length;
                
                // Or√ßamentos ativos (Pendente ou Aprovado, exceto Recusado)
                document.getElementById('statOrcamentos').textContent = 
                    this.dados.orcamentos.filter(o => o.status === 'Pendente' || o.status === 'Aprovado').length;
                
                // Servi√ßos agendados (status Agendado ou Em Andamento)
                document.getElementById('statServicos').textContent = 
                    this.dados.agendamentos.filter(a => a.status === 'Agendado' || a.status === 'Em Andamento').length;
                
                // Manuten√ß√µes pendentes (tipo Manuten√ß√£o e n√£o conclu√≠do)
                document.getElementById('statManutencoes').textContent = 
                    this.dados.agendamentos.filter(a => 
                        a.tipo === 'Manuten√ß√£o' && 
                        (a.status === 'Agendado' || a.status === 'Em Andamento')
                    ).length;
            },

            // CLIENTES
            salvarCliente() {
                const cliente = {
                    id: Date.now(),
                    nome: document.getElementById('clienteNome').value,
                    telefone: document.getElementById('clienteTelefone').value,
                    email: document.getElementById('clienteEmail').value,
                    endereco: document.getElementById('clienteEndereco').value
                };
                
                if (!cliente.nome || !cliente.telefone) {
                    this.mostrarAlerta('Preencha nome e telefone!', 'error');
                    return;
                }
                
                this.dados.clientes.push(cliente);
                this.salvarDados();
                this.atualizarTabelaClientes();
                this.limparForm(['clienteNome', 'clienteTelefone', 'clienteEmail', 'clienteEndereco']);
                this.mostrarAlerta('Cliente salvo com sucesso!', 'success');
                this.atualizarDashboard();
            },

            atualizarTabelaClientes() {
                const tbody = document.getElementById('clientesTable');
                tbody.innerHTML = this.dados.clientes.map(c => `
                    <tr>
                        <td>${c.nome}</td>
                        <td>${c.telefone}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="app.excluir('clientes', ${c.id})">Excluir</button>
                        </td>
                    </tr>
                `).join('');
                
                this.atualizarSelectsClientes();
            },

            atualizarSelectsClientes() {
                ['orcamentoCliente', 'agendamentoCliente'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = '<option value="">Selecione um cliente</option>' +
                            this.dados.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
                    }
                });
            },

            filtrarClientes() {
                const busca = document.getElementById('searchCliente').value.toLowerCase();
                document.querySelectorAll('#clientesTable tr').forEach(linha => {
                    linha.style.display = linha.textContent.toLowerCase().includes(busca) ? '' : 'none';
                });
            },

            // OR√áAMENTOS
            salvarOrcamento() {
                const orcamento = {
                    id: Date.now(),
                    clienteId: document.getElementById('orcamentoCliente').value,
                    tipo: document.getElementById('orcamentoTipo').value,
                    descricao: document.getElementById('orcamentoDescricao').value,
                    valor: document.getElementById('orcamentoValor').value,
                    status: 'Pendente',
                    data: new Date().toLocaleDateString('pt-BR')
                };
                
                if (!orcamento.clienteId || !orcamento.valor) {
                    this.mostrarAlerta('Selecione um cliente e informe o valor!', 'error');
                    return;
                }
                
                this.dados.orcamentos.push(orcamento);
                this.salvarDados();
                this.atualizarTabelaOrcamentos();
                this.limparForm(['orcamentoCliente', 'orcamentoDescricao', 'orcamentoValor']);
                this.mostrarAlerta('Or√ßamento salvo com sucesso!', 'success');
                this.atualizarDashboard();
            },

            atualizarTabelaOrcamentos() {
                const tbody = document.getElementById('orcamentosTable');
                tbody.innerHTML = this.dados.orcamentos.map(o => {
                    const cliente = this.dados.clientes.find(c => c.id == o.clienteId);
                    return `
                        <tr>
                            <td>${cliente?.nome || 'N/A'}</td>
                            <td>${o.tipo}</td>
                            <td>R$ ${parseFloat(o.valor).toFixed(2)}</td>
                            <td><span class="status-badge status-${o.status.toLowerCase()}">${o.status}</span></td>
                            <td>
                                <button class="btn btn-danger btn-small" onclick="app.excluir('orcamentos', ${o.id})">Excluir</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            // AGENDAMENTOS
            salvarAgendamento() {
                const agendamento = {
                    id: Date.now(),
                    clienteId: document.getElementById('agendamentoCliente').value,
                    tipo: document.getElementById('agendamentoTipo').value,
                    data: document.getElementById('agendamentoData').value,
                    tecnico: document.getElementById('agendamentoTecnico').value,
                    observacoes: document.getElementById('agendamentoObs').value,
                    status: document.getElementById('agendamentoStatus').value
                };
                
                if (!agendamento.clienteId || !agendamento.data) {
                    this.mostrarAlerta('Selecione um cliente e informe a data!', 'error');
                    return;
                }
                
                this.dados.agendamentos.push(agendamento);
                this.salvarDados();
                this.atualizarTabelaAgendamentos();
                this.limparForm(['agendamentoCliente', 'agendamentoData', 'agendamentoTecnico', 'agendamentoObs']);
                document.getElementById('agendamentoStatus').value = 'Agendado';
                this.mostrarAlerta('Agendamento salvo com sucesso!', 'success');
                this.atualizarDashboard();
            },

            atualizarTabelaAgendamentos() {
                const tbody = document.getElementById('agendamentosTable');
                tbody.innerHTML = this.dados.agendamentos.map(a => {
                    const cliente = this.dados.clientes.find(c => c.id == a.clienteId);
                    const dataFormatada = new Date(a.data).toLocaleString('pt-BR');
                    return `
                        <tr>
                            <td>${cliente?.nome || 'N/A'}</td>
                            <td>${dataFormatada}</td>
                            <td>${a.tipo}</td>
                            <td><span class="status-badge status-${a.status.toLowerCase().replace(' ', '-')}">${a.status}</span></td>
                            <td>
                                <button class="btn btn-info btn-small" onclick="app.editarAgendamento(${a.id})">Editar</button>
                                <button class="btn btn-danger btn-small" onclick="app.excluir('agendamentos', ${a.id})">Excluir</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            editarAgendamento(id) {
                const agendamento = this.dados.agendamentos.find(a => a.id === id);
                if (!agendamento) return;

                // Preenche o formul√°rio com os dados
                document.getElementById('agendamentoCliente').value = agendamento.clienteId;
                document.getElementById('agendamentoTipo').value = agendamento.tipo;
                document.getElementById('agendamentoData').value = agendamento.data;
                document.getElementById('agendamentoTecnico').value = agendamento.tecnico;
                document.getElementById('agendamentoObs').value = agendamento.observacoes;
                document.getElementById('agendamentoStatus').value = agendamento.status;

                // Remove o agendamento antigo (ser√° salvo novamente)
                this.dados.agendamentos = this.dados.agendamentos.filter(a => a.id !== id);
                this.salvarDados();
                
                this.mostrarAlerta('Editando agendamento. Fa√ßa as altera√ß√µes e salve.', 'success');
            },

            // MANUTEN√á√ïES
            atualizarTabelaManutencoes() {
                const tbody = document.getElementById('manutencoesTable');
                const manutencoes = this.dados.agendamentos.filter(a => 
                    a.tipo === 'Manuten√ß√£o' && a.status === 'Conclu√≠do'
                );
                
                if (manutencoes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhuma manuten√ß√£o conclu√≠da</td></tr>';
                    return;
                }
                
                tbody.innerHTML = manutencoes.map(m => {
                    const cliente = this.dados.clientes.find(c => c.id == m.clienteId);
                    const dataFormatada = new Date(m.data).toLocaleString('pt-BR');
                    return `
                        <tr>
                            <td>${dataFormatada}</td>
                            <td>${cliente?.nome || 'N/A'}</td>
                            <td>${m.observacoes || 'Manuten√ß√£o preventiva'}</td>
                            <td>${m.tecnico || 'N/A'}</td>
                        </tr>
                    `;
                }).join('');
            },

            // USU√ÅRIOS
            salvarUsuario() {
                const usuario = {
                    nome: document.getElementById('usuarioNome').value,
                    login: document.getElementById('usuarioLogin').value,
                    senha: btoa(document.getElementById('usuarioSenha').value),
                    tipo: document.getElementById('usuarioTipo').value
                };
                
                if (!usuario.nome || !usuario.login || !document.getElementById('usuarioSenha').value) {
                    this.mostrarAlerta('Preencha todos os campos!', 'error');
                    return;
                }
                
                if (this.dados.usuarios.find(u => u.login === usuario.login)) {
                    this.mostrarAlerta('Usu√°rio j√° existe!', 'error');
                    return;
                }
                
                this.dados.usuarios.push(usuario);
                this.salvarDados();
                this.atualizarTabelaUsuarios();
                this.limparForm(['usuarioNome', 'usuarioLogin', 'usuarioSenha']);
                this.mostrarAlerta('Usu√°rio salvo com sucesso!', 'success');
            },

            atualizarTabelaUsuarios() {
                const tbody = document.getElementById('usuariosTable');
                tbody.innerHTML = this.dados.usuarios.map(u => {
                    const isAdmin = u.login === 'admin';
                    const isCurrentUser = u.login === this.usuarioLogado?.login;
                    return `
                        <tr>
                            <td>${u.nome}</td>
                            <td>${u.login}</td>
                            <td>${u.tipo}</td>
                            <td>
                                ${!isAdmin ? `
                                    <button class="btn btn-danger btn-small" 
                                        onclick="app.excluirUsuario('${u.login}')" 
                                        ${isCurrentUser ? 'disabled' : ''}>
                                        Excluir
                                    </button>
                                ` : '<span style="color: #999; font-size: 12px;">Protegido</span>'}
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            excluirUsuario(login) {
                if (login === 'admin') {
                    this.mostrarAlerta('O usu√°rio admin n√£o pode ser exclu√≠do!', 'error');
                    return;
                }
                
                if (login === this.usuarioLogado.login) {
                    this.mostrarAlerta('Voc√™ n√£o pode excluir seu pr√≥prio usu√°rio!', 'error');
                    return;
                }
                
                if (confirm('Deseja realmente excluir este usu√°rio?')) {
                    this.dados.usuarios = this.dados.usuarios.filter(u => u.login !== login);
                    this.salvarDados();
                    this.atualizarTabelaUsuarios();
                    this.mostrarAlerta('Usu√°rio exclu√≠do!', 'success');
                }
            },

            // FUN√á√ïES AUXILIARES
            excluir(tipo, id) {
                if (confirm(`Deseja realmente excluir este ${tipo.slice(0, -1)}?`)) {
                    this.dados[tipo] = this.dados[tipo].filter(item => item.id !== id);
                    this.salvarDados();
                    
                    const atualizadores = {
                        'clientes': () => this.atualizarTabelaClientes(),
                        'orcamentos': () => this.atualizarTabelaOrcamentos(),
                        'agendamentos': () => this.atualizarTabelaAgendamentos()
                    };
                    
                    if (atualizadores[tipo]) atualizadores[tipo]();
                    this.mostrarAlerta('Exclu√≠do com sucesso!', 'success');
                    this.atualizarDashboard();
                }
            },

            limparForm(ids) {
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                });
            },

            // IMPORTAR/EXPORTAR EXCEL
            importarExcel(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        let importados = 0;
                        let erros = 0;

                        jsonData.forEach(row => {
                            // Verifica se tem os campos obrigat√≥rios
                            if (row.Nome && row.Telefone) {
                                const cliente = {
                                    id: Date.now() + Math.random(),
                                    nome: row.Nome || '',
                                    telefone: row.Telefone || '',
                                    email: row.Email || '',
                                    endereco: row.Endereco || row['Endere√ßo'] || ''
                                };
                                this.dados.clientes.push(cliente);
                                importados++;
                            } else {
                                erros++;
                            }
                        });

                        this.salvarDados();
                        this.atualizarTabelaClientes();
                        this.atualizarDashboard();
                        
                        this.mostrarAlerta(`‚úÖ ${importados} clientes importados com sucesso! ${erros > 0 ? `(${erros} linhas com erro)` : ''}`, 'success');
                    } catch (error) {
                        console.error('Erro ao importar:', error);
                        this.mostrarAlerta('‚ùå Erro ao importar arquivo. Verifique o formato!', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
                
                // Limpa o input para permitir importar o mesmo arquivo novamente
                event.target.value = '';
            },

            exportarExcel() {
                if (this.dados.clientes.length === 0) {
                    this.mostrarAlerta('N√£o h√° clientes para exportar!', 'error');
                    return;
                }

                // Prepara os dados para exporta√ß√£o
                const dadosExport = this.dados.clientes.map(c => ({
                    'Nome': c.nome,
                    'Telefone': c.telefone,
                    'Email': c.email,
                    'Endere√ßo': c.endereco
                }));

                // Cria a planilha
                const worksheet = XLSX.utils.json_to_sheet(dadosExport);
                
                // Ajusta largura das colunas
                worksheet['!cols'] = [
                    { wch: 30 }, // Nome
                    { wch: 15 }, // Telefone
                    { wch: 30 }, // Email
                    { wch: 40 }  // Endere√ßo
                ];

                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Clientes');

                // Gera o arquivo
                const dataAtual = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                XLSX.writeFile(workbook, `Clientes_${dataAtual}.xlsx`);
                
                this.mostrarAlerta('‚úÖ Planilha exportada com sucesso!', 'success');
            },

            baixarModeloExcel() {
                // Cria um modelo com exemplo
                const modelo = [
                    {
                        'Nome': 'Exemplo Cliente 1',
                        'Telefone': '(11) 98765-4321',
                        'Email': 'cliente1@email.com',
                        'Endere√ßo': 'Rua Exemplo, 123 - S√£o Paulo/SP'
                    },
                    {
                        'Nome': 'Exemplo Cliente 2',
                        'Telefone': '(21) 91234-5678',
                        'Email': 'cliente2@email.com',
                        'Endere√ßo': 'Av. Exemplo, 456 - Rio de Janeiro/RJ'
                    }
                ];

                const worksheet = XLSX.utils.json_to_sheet(modelo);
                
                // Ajusta largura das colunas
                worksheet['!cols'] = [
                    { wch: 30 },
                    { wch: 15 },
                    { wch: 30 },
                    { wch: 40 }
                ];

                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Modelo');

                XLSX.writeFile(workbook, 'Modelo_Clientes.xlsx');
                
                this.mostrarAlerta('‚úÖ Modelo baixado! Preencha e importe.', 'success');
            }
        };

        // Inicializar aplica√ß√£o
        app.init();
    </script>
</body>
</html>
